priority: 918
help: DNS forwarding
commit:expression: $VAR(./listen-on) != ""; "At least one interface must be configured for DNS forwarding parameter 'listen-on'"
end:expression: "if [ -f \"/tmp/dnsmasq.$PPID\" ]; then \
    sudo /opt/vyatta/sbin/vyatta-dns-forwarding.pl --stop-dnsforwarding; \
    rm /tmp/dnsmasq.$PPID; \
    else \
        if [ -f \"/tmp/update-blacklists-dnsmasq.$PPID\" ]; then \
            echo 'ADBLOCK: Updating /etc/dnsmasq.d/dnsmasq.blacklist.conf'; \
            sudo /config/scripts/update-blacklists-dnsmasq.pl --in-cli; \
            sudo rm /tmp/update-blacklists-dnsmasq.$PPID; \
            touch /tmp/dnsmasq.$PPID; \
        fi; \
        sudo /opt/vyatta/sbin/vyatta-dns-forwarding.pl --update-dnsforwarding; \
    fi;"